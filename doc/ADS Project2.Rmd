---
title: "ADS Project2"
author: "NAN YANG"
date: "10/2/2019"
output: html_document
---

```{r}

case_type <- c("Comprehensive",
              "Heat and Hot Water",
              "Access Warrant - Non-Lead",
              "Tenant Action",
              "False Certification Non-Lead",
              "Heat Supplemental Cases",
              "Tenant Action/Harrassment",
              "CONH",
              "Access Warrant - lead",
              "Comp Supplemental Cases",
              "Lead False Certification",
              "Failure to Register Only",
              "7A",
              "HLD - Other Case Type")

data1<-read.csv("~/Desktop/Project2-ShinyApp/Part1/data/processed_data.csv")
under <- readOGR("~/Desktop/Project2-ShinyApp/data/ZipcodeShapeFile/ZIP_CODE_040114.shp")
```

```{r}
library(rgdal)
library(leaflet)
library(shiny)
library(dplyr)
library(raster)
library(tigris)
library(sp)
library(ggmap)
library(maptools)
library(broom)
library(httr)
```

```{r}
ui <- fluidPage(
  h1("Map of Frequences"),
  sidebarLayout(
    sidebarPanel(
       selectInput("Zip_frequence", "Case:", case_type
                   )
    ),
    mainPanel(
      leafletOutput("mymap",height = 1000)
    )
  )
)
```

```{r}

server=function(input, output) {
  output$mymap <- renderLeaflet({
    datasliced<-data1[which(data1$CaseType==input$Zip_frequence),]
    ZIPCODE<-names(table(datasliced$Zip))
    frequence<-unname(table(datasliced$Zip))
    Zip<-as.data.frame(cbind(ZIPCODE,frequence))
    #Zip <- Zip[-c(43,58,178),]
    under1 <- subset(under, is.element(Zip$ZIPCODE, under$ZIPCODE))
    under2 <- subset(under1, is.element(under1$ZIPCODE, Zip$ZIPCODE))
    #under@data$POPULATION = rep(0,180)
    under2@data = merge(x=under2@data, y=Zip, by = "ZIPCODE", all.x = TRUE)
    subdat1 <- spTransform(under2, CRS("+init=epsg:4326"))
    subdat1@data$frequence <- as.numeric(subdat1@data$frequence)

    bins <- c(100)
    pal <- colorBin("Blues", domain = subdat1$frequence, bins = bins)

    m <- leaflet(under) %>%
      addProviderTiles(providers$Stamen.Toner) %>%
      setView(lng = -73.98928, lat = 40.75042, zoom = 12)%>% 
      addPolygons(data = subdat1,
                  weight = 1,
                  smoothFactor = 0.5,
                  color = "white",
                  fillOpacity = 0.8,
                  fillColor = pal(subdat1$frequence))})
      
  }
    
```

```{r}

# Run the app ----
shinyApp(ui = ui, server = server)


```

